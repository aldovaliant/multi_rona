<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sistem Informasi Penjualan dan Inventaris Multirona</title>
    <link rel="stylesheet" href="css/w3.css" />
    <link rel="stylesheet" href="css/sidenav.css" />
    <link rel="stylesheet" href="css/reminder.css" />

    <link rel="stylesheet" href="../fonts/fontawesome/css/all.css" />
    <link
      rel="stylesheet"
      href="../bootstrap-4.1.3-dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="css/main.css" />
    <script>
      window.jQuery = window.$ = require("jquery");
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
      hr {
        border: 2px solid;
      }
      .fa-edit {
        color: rgb(0, 47, 255);
      }
      .fa-trash-alt {
        color: red;
      }
      .btn-aksi {
        margin-left: 5px;
        margin-right: 5px;
      }
      .search-container button,
      input {
        float: right;
        margin-left: 5px;
      }
      #edit-input label,
      input {
        margin-top: 5px;
      }
      #edit-input input {
        float: left;
      }
      #edit-input-ecer label {
        margin-top: 5px;
      }
      #edit-input-ecer hr {
        width: 2px;
      }
    </style>
  </head>
  <body>
    <div class="sidenav">
      <div class="sidebar-content">
        <div class="sidebar-item sidebar-header d-flex flex-nowrap">
          <div class="user-pic">
            <i class="fa fa-user w3-xxlarge"></i>
          </div>
          <div class="user-info">
            <span class="user-name"><strong>Setiadi</strong></span
            ><br />
            <span class="user-role">Owner</span>
          </div>
        </div>
      </div>
      <hr />
      <h1>Menu</h1>
      <a href="dashboard.html"
        ><i class="fa fa-home w3-xlarge"></i> Dashboard</a
      >
      <a href="penjualan.html"
        ><i class="fa fa-shopping-bag w3-xlarge"></i> Penjualan</a
      >
      <button class="dropdown-btn">
        <i class="fas fa-list-ul w3-xlarge"></i>
        Inventaris
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-container">
        <a class="active" href="inventaris_stok.html"
          ><i class="fas fa-circle w3-small"></i> Stok Produk</a
        >
        <a href="inventaris_masuk.html"
          ><i class="fas fa-circle w3-small"></i> Tambah Stok</a
        >
        <a href="inventaris_edit.html"
          ><i class="fas fa-circle w3-small"></i> Edit Stok</a
        >
        <a href="peralatan.html"
          ><i class="fas fa-circle w3-small"></i> Peralatan</a
        >
      </div>
      <button class="dropdown-btn">
        <i class="fas fa-folder-open w3-xlarge"></i>
        Data Produk
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-container">
        <a href="data_produk_list.html"
          ><i class="fas fa-circle w3-small"></i> List Produk</a
        >
        <a href="data_produk_jenis.html"
          ><i class="fas fa-circle w3-small"></i> Jenis Produk</a
        >
        <a href="data_produk_satuan.html"
          ><i class="fas fa-circle w3-small"></i> Satuan</a
        >
      </div>
      <button class="dropdown-btn" id="laporan-nav">
        <i class="fas fa-folder-open w3-xlarge"></i>
        Laporan
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-container">
        <a href="laporan_penjualan.html"
          ><i class="fas fa-circle w3-small"></i> Laporan Penjualan</a
        >
        <a href="laporan_stok.html"
          ><i class="fas fa-circle w3-small"></i> Laporan Stok Produk</a
        >
      </div>
      <a href="supplier.html"
        ><i class="fab fa-dropbox w3-xlarge"></i> Supplier</a
      >
      <a href="pelanggan.html"
        ><i class="fas fa-user w3-xlarge"></i> Pelanggan</a
      >
      <a href="pengguna.html" style="bottom: 6%; position: absolute"
        ><i class="fa fa-user-circle w3-xlarge"></i> Pengguna</a
      >
      <a href="login.html" style="bottom: 0; position: absolute"
        ><i class="fa fa-sign-out-alt w3-xlarge"></i> Keluar</a
      >
    </div>

    <div class="main">
      <div class="container" id="judul">
        <h2>Inventaris</h2>
        <hr />
      </div>

      <div class="container">
        <h3>Stok Produk</h3>
        <div class="container">
          <input
            type="text"
            placeholder="Ketik untuk mencari..."
            id="search-input"
            style="margin-bottom: 10px; float: left"
          />&nbsp;
          <i class="fa fa-search" style="margin-top: 10px"></i>
        </div>

        <table class="" style="text-align: center">
          <colgroup>
            <col span="1" style="width: 5%" />
            <col span="1" style="width: 30%" />
            <col span="1" style="width: 15%" />
            <col span="1" style="width: 10%" />
            <col span="1" style="width: 10%" />
            <col span="1" style="width: 10%" />
            <col span="1" style="width: 10%" />
          </colgroup>
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Produk</th>
              <th>Satuan</th>
              <th>Jumlah Stok</th>
              <th>Batas Re-supply</th>
              <th>Jumlah Konversi</th>
              <th>Eceran</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="list-tbody"></tbody>
        </table>
      </div>

      <div class="container">
        <!-- The Modal -->
        <div class="modal" id="myModalDetail">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <!-- Modal Header -->
              <div class="modal-header">
                <h4 class="modal-title">Detail Stok</h4>
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  onclick="clearDetail()"
                >
                  &times;
                </button>
              </div>

              <!-- Modal body -->
              <div class="modal-body">
                <div class="row">
                  <div class="col">
                    <p>Nama Produk &emsp;</p>
                    <p>Satuan Beli &emsp;</p>
                    <p>Jumlah Stok Utama&nbsp;</p>
                    <p>Batas Resupply</p>
                    <p>Jumlah Konversi</p>
                    <p>Supplier &emsp;&emsp;</p>
                  </div>
                  <div class="col-7">
                    <p id="detail-nama">:</p>
                    <p id="detail-satuan">:</p>
                    <p id="detail-jumlah">:</p>
                    <p id="detail-batas">:</p>
                    <p id="detail-konversi">:</p>
                    <p id="detail-supplier">:</p>
                  </div>
                </div>
                <!-- <hr /> -->
                <div id="div-ecer" style="display: none">
                  <table id="eceran-tbl">
                    <colgroup>
                      <col span="1" style="width: 5%" />
                      <col span="1" style="width: 30%" />
                      <col span="1" style="width: 20%" />
                      <col span="1" style="width: 45%" />
                    </colgroup>
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Satuan Eceran</th>
                        <th>Jumlah Eceran</th>
                        <th>Keterangan</th>
                      </tr>
                    </thead>
                    <tbody id="detail-tbody"></tbody>
                  </table>
                </div>
              </div>

              <!-- Modal footer -->
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-danger"
                  data-dismiss="modal"
                  onclick="clearDetail()"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/side_nav.js"></script>

    <script type="text/javascript">
      const Dialogs = require("dialogs");
      const dialogs = Dialogs();
      var baseUrl = sessionStorage.getItem("baseUrl");
      // var baseUrl = "http://multirona.000webhostapp.com/index.php/";
      // var baseUrl = "http://localhost/multi_rona/";
      // if (sessionStorage.getItem("online_db") == true)
      //   baseUrl = "http://multirona.000webhostapp.com/index.php/";
      // else baseUrl = "http://localhost/multi_rona/";
      var arrProduk = [];
      window.onload = getProduk();
      if (sessionStorage.getItem("jenis_user") != "pemilik") {
        $("#laporan-nav").css("display", "none");
      }

      dropdown = document.getElementsByClassName("dropdown-container");
      dropdown[0].addEventListener("click", function () {
        this.classList.toggle("active");
      });

      function getProduk() {
        // let url =
        //   "http://multirona.000webhostapp.com/index.php/inventaris/stok";
        let url = baseUrl + "inventaris/stok";
        fetch(url)
          .then((resp) => resp.json())
          .then(function (data) {
            arrProduk = data;
            createTable();
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function createTable() {
        let tbl = document.createElement("table");
        let thead = document.createElement("thead");
        let tbody = document.getElementById("list-tbody");

        for (let i = 0, k = 1; i < arrProduk.length; i++, k++) {
          let btnDetail = document.createElement("button");
          btnDetail.appendChild(document.createTextNode("detail"));
          btnDetail.className = "btn btn-secondary btn-aksi btn-detail";
          btnDetail.onclick = function () {
            getDetail(this);
          };

          let tr = document.createElement("tr");
          let td = document.createElement("td");
          td.textContent = i + 1;
          tr.appendChild(td);

          td = document.createElement("td");
          td.textContent = arrProduk[i].nama;
          td.className = "list-nama";
          tr.appendChild(td);

          td = document.createElement("td");
          td.textContent = arrProduk[i].nama_satuan;
          tr.appendChild(td);

          td = document.createElement("td");
          td.textContent = arrProduk[i].jumlah_utama;
          tr.appendChild(td);

          td = document.createElement("td");
          td.textContent = arrProduk[i].batas_resupply;
          tr.appendChild(td);

          td = document.createElement("td");
          td.textContent = arrProduk[i].jumlah_konversi;
          tr.appendChild(td);

          td = document.createElement("td");
          if (arrProduk[i].is_eceran == 0) td.textContent = "Tidak";
          else {
            td.textContent = "Ada";
          }
          tr.appendChild(td);

          td = document.createElement("td");
          td.appendChild(btnDetail);
          tr.appendChild(td);

          tbody.appendChild(tr);
        }
        $(".btn-detail").attr("data-toggle", "modal");
        $(".btn-detail").attr("data-target", "#myModalDetail");
      }

      function getDetail(param) {
        // clearDetail();
        let x = param.parentNode.parentNode.rowIndex - 1;
        let id = arrProduk[x].id;
        // let url =
        //   "http://multirona.000webhostapp.com/index.php/inventaris/detail?id=" +
        //   id;
        let url = baseUrl + "inventaris/detail?id=" + id;
        fetch(url)
          .then((resp) => resp.json())
          .then(function (data) {
            console.log(data);
            let temp = ":&emsp;";
            document.getElementById("detail-nama").innerHTML =
              temp + arrProduk[x].nama;
            document.getElementById("detail-jumlah").innerHTML =
              temp + arrProduk[x].jumlah_utama;
            document.getElementById("detail-batas").innerHTML =
              temp + arrProduk[x].batas_resupply;
            document.getElementById("detail-konversi").innerHTML =
              temp + arrProduk[x].jumlah_konversi;
            document.getElementById("detail-satuan").innerHTML =
              temp + data[0].nama_satuan;
            document.getElementById("detail-supplier").innerHTML =
              temp + data[0].nama;
            if (arrProduk[x].is_eceran == 1) {
              document.getElementById("div-ecer").style.display = "block";
              let tbody = document.getElementById("detail-tbody");
              let arr = data[0].arr_ecer;
              for (let i = 0; i < arr.length; i++) {
                let tr = document.createElement("tr");

                let td = document.createElement("td");
                td.textContent = i + 1;
                tr.appendChild(td);

                td = document.createElement("td");
                td.textContent = arr[i].nama_satuan;
                tr.appendChild(td);

                td = document.createElement("td");
                td.textContent = arr[i].jumlah_eceran;
                tr.appendChild(td);

                td = document.createElement("td");
                td.textContent = arr[i].keterangan;
                tr.appendChild(td);

                tbody.appendChild(tr);
              }
            } else {
              document.getElementById("div-ecer").style.display = "none";
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      $(document).ready(function () {
        $("#search-input").on("keyup", function () {
          let value = $(this).val().toLowerCase();
          $("#list-tbody tr").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
          });
        });
      });

      $("#myModalDetail").on("hidden.bs.modal", function () {
        clearDetail();
      });

      function clearDetail() {
        document.getElementById("detail-nama").innerHTML = ":";
        document.getElementById("detail-jumlah").innerHTML = ":";
        document.getElementById("detail-batas").innerHTML = ":";
        document.getElementById("detail-satuan").innerHTML = ":";
        document.getElementById("detail-konversi").innerHTML = ":";
        document.getElementById("detail-supplier").innerHTML = ":";
        $("#div-ecer").css("display", "none");
        $("#eceran-tbl > tbody").empty();
      }
    </script>
  </body>
</html>
